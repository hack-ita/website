{{/* =====================================
   TAXONOMY FILTERS (CATEGORY + SUBCATEGORY)
   Source of truth:
   - Categories  → .Site.Taxonomies.categories
   - Subcategories → category _index.md (subcategories)
===================================== */}}

{{ $site := .Site }}

<div class="flex flex-col gap-5 sm:flex-row sm:justify-between sm:items-center mb-10">
  <h4 class="heading-sm text-dark dark:text-light">Filtri</h4>

  <div
    id="taxonomyFilters"
    class="flex flex-col sm:flex-row gap-4 sm:items-end"
  >

    {{/* CATEGORY FILTER */}}
    <div class="flex flex-col gap-1">
      <label class="text-sm font-medium uppercase text-dark dark:text-light">
        Categoria
      </label>
      <select
        id="filter-category"
        class="taxonomy-select min-w-40 rounded-md border border-primary
               bg-white dark:bg-accent
               py-2 text-sm uppercase
               text-dark dark:text-light
               focus:outline-none focus:ring-2 focus:ring-primary transition">
        <option value="all">TUTTE</option>
        {{ range $site.Taxonomies.categories }}
          <option value="{{ .Page.Title | urlize }}">
            {{ .Page.Title }}
          </option>
        {{ end }}
      </select>
    </div>

    {{/* SUBCATEGORY FILTER */}}
    <div class="flex flex-col gap-1">
      <label class="text-sm font-medium uppercase text-dark dark:text-light">
        Sottocategoria
      </label>
      <select
        id="filter-subcategory"
        disabled
        class="taxonomy-select min-w-40 rounded-md border border-primary
               bg-white dark:bg-accent
               py-2 text-sm uppercase
               text-dark dark:text-light
               opacity-60 cursor-not-allowed
               focus:outline-none focus:ring-2 focus:ring-primary transition">
        <option>SELEZIONA CATEGORIA</option>
      </select>
    </div>

    <button
      type="button"
      class="text-sm font-medium text-primary hover:underline transition uppercase clear-filters text-start sm:text-center">
      Azzera filtri
    </button>

  </div>
</div>

{{/* =====================================
   CATEGORY → SUBCATEGORY MAP
===================================== */}}
<script type="application/json" id="categorySubcategoryMap">
{
{{- $first := true -}}
{{- range $term, $termPages := $site.Taxonomies.categories -}}
  {{- $catPage := $termPages.Page -}}
  {{- if not $first }},{{ end -}}
  "{{ $term | urlize }}": [
    {{- with $catPage.Params.subcategories -}}
      {{- range $i, $sc := . -}}
        {{- if $i }},{{ end -}}
        {
          "label": "{{ $sc }}",
          "value": "{{ $sc | urlize }}"
        }
      {{- end -}}
    {{- end -}}
  ]
  {{- $first = false -}}
{{- end -}}
}
</script>